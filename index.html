<html>
<head>
<title>INFO/CS 3300 - Project 2 (asz35, hju3, lgd34)</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v2.min.js"></script>
<style>
            .track {
                stroke: #000;
                stroke-opacity: 0.3;
                stroke-width: 10px;
            }

            .track-inset {
                stroke: #ddd;
                stroke-width: 8px;
            }

            .track-overlay {
                pointer-events: stroke;
                stroke-width: 50px;
                cursor: crosshair;
            }

            .handle {
                fill: #fff;
                stroke: #000;
                stroke-opacity: 0.5;
                stroke-width: 1.25px;
            }

            svg {
            border: solid #ccc 1px;
            }
    </style>
</head>
<body>
<svg width="800px" height="600px"></svg>
<script>
// Disaster data from: https://www.fema.gov/disasters/grid/year
    d3.queue()
    .defer(d3.csv, "data/disasters.csv", function(row) {
        return { year: Number(row["Date"]), state: row["State"], incident: row["Incident Description"]};
    })
    .await( function (error, disasterDataw, gridMapData) {
        
    
       
// Grid Map
    
    d3.csv("data/gridmap-layout-usa.csv", function(data) {
        data.forEach(function(d) {
            d.x = +d.x;
            d.y = +d.y;
        });
        drawMap(data, disasterDataw);

    });
        
    })
    
    var currentyear = 1960;

    function drawMap(arrayofcoordinates, disasters) {
        var mapSVG = d3.select("svg");
        var linearScale = d3.scaleLinear().domain([0, 0.025]);
        var states = mapSVG.selectAll("circle")
            .data(arrayofcoordinates);

        states.enter().append("circle")
            .attr("cx", function(d) {return linearScale(d.x+4);})
            .attr("cy", function(d) {return linearScale(d.y+3);})
            .attr("id", function(d) {return d.name;})
            .attr("r", 20)
            .on("click", function(d) {
                statetext.text("State: " + d.name);
                disastertext.text(function(){
                    var count = 0;
                    disasters.forEach(function(i){
                        if(d.name == i.state  && currentyear == i.year){
                            count = count + 1;
                        }
                    })
                    return "# of Disaster: " + count;
                })
            })
            //.merge(states)
                .style("stroke", "#eee")
                .style("fill", "blue");

    }

//yearslider
        var svg = d3.select("svg")
        var x = d3.scaleLinear()
        .domain([1960, 2016])
        .range([0, 350])
        .clamp(true);
        var yeartext = svg.append("text")
        .text("Year: 1960")
        .attr("transform", "translate(50,525)");
        var slider = svg.append("g")
        .attr("class", "slider")
        .attr("transform", "translate(50,550)");
    
        slider.append("line")
        .attr("class", "track")
        .attr("x1", 0)
        .attr("x2", 350)
        .attr("stroke-linecap", "round")
        .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
        .attr("class", "track-inset")
        .attr("stroke-linecap", "round")
        .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
        .attr("class", "track-overlay")
        .attr("stroke-linecap", "round")
        .call(d3.drag()
        .on("start.interrupt", function() { slider.interrupt(); })
        .on("start drag", function() { year(Math.floor(x.invert(d3.event.x))); }));


        var handle = slider.insert("circle", ".track-overlay")
        .attr("class", "handle")
        .attr("r", 9);
        
        function year(y) {
            handle.attr("cx", x(y));
            yeartext.text("Year: " + y);
            currentyear = y;
            
        }
    
    //stateinfo
    var statetext= svg.append("text")
        .text("State:")
        .attr("transform", "translate(550,525)");
    var temptext= svg.append("text")
        .text("Avg. Temperature:")
        .attr("transform", "translate(550,550)");
    var disastertext= svg.append("text")
        .text("# of Disasters:")
        .attr("transform", "translate(550,575)");
</script>
</body>